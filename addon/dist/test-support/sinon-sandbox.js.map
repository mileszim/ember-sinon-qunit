{"version":3,"file":"sinon-sandbox.js","sources":["../../src/test-support/sinon-sandbox.js"],"sourcesContent":["import sinon from 'sinon';\n\nlet originalUseFakeTimers;\nlet clockToRestore;\n\n/**\n * Performs setup functionality for the sandbox before each test\n *\n * @public\n */\nexport function createSandbox() {\n  if (!originalUseFakeTimers) {\n    patchUseFakeTimers(sinon);\n  }\n}\n\n/**\n * Restores the sandbox & timers at the end of each test.\n *\n * @public\n */\nexport function restoreSandbox() {\n  if (clockToRestore) {\n    clockToRestore.restore();\n    clockToRestore = null;\n  }\n\n  sinon.restore();\n}\n\n/**\n * Patches the `useFakeTimers` method in `sinon` to ensure\n * created clocks are tracked and subsequently restored after\n * each test is complete. Calling this more than once within a single\n * test will result in an error thrown.\n *\n * @param {object} sandbox\n * @returns {object} a clock object returned from `useFakeTimers`\n */\nfunction patchUseFakeTimers(sandbox) {\n  originalUseFakeTimers = sandbox.useFakeTimers;\n\n  sandbox.useFakeTimers = function () {\n    if (clockToRestore) {\n      throw new Error(\n        \"You called sinon's useFakeTimers multiple times within the same test. This can result in unknown behavior.\"\n      );\n    }\n\n    let clock = originalUseFakeTimers.apply(sandbox, arguments);\n\n    clockToRestore = clock;\n\n    return clock;\n  };\n}\n"],"names":["originalUseFakeTimers","clockToRestore","createSandbox","patchUseFakeTimers","sinon","restoreSandbox","restore","sandbox","useFakeTimers","Error","clock","apply","arguments"],"mappings":";;AAEA,IAAIA,qBAAqB,CAAA;AACzB,IAAIC,cAAc,CAAA;;AAElB;AACA;AACA;AACA;AACA;AACO,SAASC,aAAa,GAAG;EAC9B,IAAI,CAACF,qBAAqB,EAAE;IAC1BG,kBAAkB,CAACC,KAAK,CAAC,CAAA;AAC3B,GAAA;AACF,CAAA;;AAEA;AACA;AACA;AACA;AACA;AACO,SAASC,cAAc,GAAG;AAC/B,EAAA,IAAIJ,cAAc,EAAE;IAClBA,cAAc,CAACK,OAAO,EAAE,CAAA;AACxBL,IAAAA,cAAc,GAAG,IAAI,CAAA;AACvB,GAAA;EAEAG,KAAK,CAACE,OAAO,EAAE,CAAA;AACjB,CAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASH,kBAAkB,CAACI,OAAO,EAAE;EACnCP,qBAAqB,GAAGO,OAAO,CAACC,aAAa,CAAA;EAE7CD,OAAO,CAACC,aAAa,GAAG,YAAY;AAClC,IAAA,IAAIP,cAAc,EAAE;AAClB,MAAA,MAAM,IAAIQ,KAAK,CACb,4GAA4G,CAC7G,CAAA;AACH,KAAA;IAEA,IAAIC,KAAK,GAAGV,qBAAqB,CAACW,KAAK,CAACJ,OAAO,EAAEK,SAAS,CAAC,CAAA;AAE3DX,IAAAA,cAAc,GAAGS,KAAK,CAAA;AAEtB,IAAA,OAAOA,KAAK,CAAA;GACb,CAAA;AACH;;;;"}